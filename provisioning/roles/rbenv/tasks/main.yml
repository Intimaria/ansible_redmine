- name: Download Rbenv
  git: 
    repo: https://github.com/sstephenson/rbenv.git
    dest: "/home/{{ user_name }}/.rbenv"
    version: v1.2.0

- name: Download Ruby-Build
  git: 
    repo: https://github.com/rbenv/ruby-build.git
    dest: "/home/{{ user_name }}/.rbenv/plugins/ruby-build"

- name: Export Rbenv to PATH
  lineinfile: 
    dest: "/home/{{ user_name}}/.bashrc" 
    line: "export PATH=\"$HOME/.rbenv/bin:$PATH\""

- name: Edit .bashrc
  lineinfile: 
    dest: "/home/{{ user_name}}/.bashrc"
    line: "eval \"$(rbenv init -)\""

- name: Check Installed Ruby 
  shell: "/home/{{ user_name }}/.rbenv/bin/rbenv versions | grep {{ rbenv.default_ruby }}"
  register: ruby_installed
  ignore_errors: true

- name: Install Ruby
  shell: "/home/{{ user_name }}/.rbenv/bin/rbenv install {{ rbenv.default_ruby }} -k"
  when: "ruby_installed.rc == 1"

- name: Global Ruby Version
  shell: "/home/{{ user_name }}/.rbenv/bin/rbenv global {{ rbenv.default_ruby }}"
  ignore_errors: yes

- name: Install Bundler                                                                                                                      
  become_user: "{{ user_name }}"                                                                                                         
  gem:                                                                                                                                                  
    name: bundler                                                                                                                              
